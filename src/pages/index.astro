---
import "../styles/global.css";
import Layout from '../layouts/Layout.astro';
import Pricing from '../components/Pricing.vue';
import Header from '../components/Header.vue';
import FleetCard from '../components/FleetCard.astro';
import { getCollection } from 'astro:content';
import  Contact from '../components/Contact.astro';
import Hero from '../components/Hero.vue';
import NewsCard from '../components/NewsCard.astro';
import WeatherWidget from '../components/WeatherWidget.vue'; 

import { getEntry } from 'astro:content';

// 1. R√©cup√©rer les donn√©es du fichier hero.md
const heroEntry = await getEntry('sections', 'hero')!;
const { Content: HeroContent } = await heroEntry.render();
import { marked } from 'marked'; // <--- Import de la librairie

// R√©cup√©ration des actualit√©s
const allNews = await getCollection('news');
// Tri par date d√©croissante et r√©cup√©ration des 3 premi√®res
const latestNews = allNews
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf())
  .slice(0, 3);

// R√©cup√©ration des pages sp√©ciales
const allPages = await getCollection('pages');

// On filtre celles qui doivent apparaitre sur l'accueil ET on les trie par ordre
const featuredPages = allPages
  .filter(page => page.data.showOnHomepage === true)
  .sort((a, b) => (a.data.order || 99) - (b.data.order || 99));


// R√©cup√©ration des donn√©es Tarifs
const pricingEntry = await getEntry('pricing', 'pricing')!;
const pricingData = pricingEntry.data;
const happyHourHtml = pricingData.happyHourText 
  ? marked.parse(pricingData.happyHourText) 
  : '';

//  console.error(happyHourHtml)
// R√©cup√©ration des donn√©es MDX
const fleet = await getCollection('fleet');
// Tri des bateaux : Catamarans d'abord, puis Kayaks/Paddle
const sortedFleet = fleet.sort((a, b) => a.data.type.localeCompare(b.data.type));

---

<Layout title="√âmeraude Loca-fun | Location Catamaran & Kayak √† Lancieux">
  <Header client:load />

<Hero 
    client:load
    title={heroEntry.data.title}
    subtitle={heroEntry.data.subtitle}
    saison={heroEntry.data.saison}
    image={heroEntry.data.image!}
  >
    <!-- On injecte le corps du texte (le body du markdown) dans le slot du composant -->
    <HeroContent />
	</Hero>


<!-- NOUVELLE SECTION : ACTUALIT√âS -->
 <section class="py-12 bg-gray-50 relative z-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      
      <!-- Layout : Colonne Actus (gauche) / Colonne M√©t√©o (droite) -->
      <div class="grid lg:grid-cols-3 gap-8 items-start">
        
        <!-- COLONNE GAUCHE : LES ACTUALIT√âS (Prend 2 colonnes sur grand √©cran) -->
        <div class="lg:col-span-2">
           <div class="flex justify-between items-end mb-6">
              <h2 class="text-2xl font-bold text-gray-900 font-heading">Derni√®res Actualit√©s</h2>
              <a href="/actualites" class="text-emerald-600 font-bold hover:text-emerald-800 text-sm">Toutes les actus ‚Üí</a>
           </div>

           {latestNews.length > 0 ? (
             <div class="grid sm:grid-cols-2 gap-6">
                {/* On affiche seulement les 2 derni√®res actus pour l'√©quilibre visuel, ou 3 si vous pr√©f√©rez */}
                {latestNews.slice(0, 2).map(news => (
                  <NewsCard 
                    title={news.data.title}
                    publishDate={news.data.publishDate}
                    excerpt={news.data.excerpt}
                    image={news.data.image}
                    slug={news.slug}
                  />
                ))}
             </div>
           ) : (
             <p class="text-gray-500 italic">La saison reprend bient√¥t !</p>
           )}
        </div>

        <!-- COLONNE DROITE : WIDGET M√âT√âO (Sticky pour rester visible) -->
        <div class="lg:col-span-1 lg:sticky lg:top-24 mt-8 lg:mt-0">
          <h3 class="text-lg font-bold text-gray-900 mb-4 font-heading pl-1">Conditions en direct</h3>
          <!-- Le Widget Vue -->
          <WeatherWidget client:visible />
          
          <p class="text-xs text-gray-400 mt-2 text-center">
            Donn√©es GFS 13km via Open-Meteo. <br>Mise √† jour toutes les heures.
          </p>
        </div>

      </div>

    </div>
  </section>

  <!-- FLOTTE SECTION -->
  <section id="fleet" class="py-20 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 text-center">
      <div class=" mb-8">
        <h2 class="text-4xl font-bold text-gray-900 mb-4">Notre Flotte</h2>
<div class="flex justify-center"> <!-- Centre le bloc enfant -->
  <div class="w-fit text-left">   <!-- Le bloc s'adapte au contenu -->
        <p class="text-xl text-gray-600">C√¥t√© matos ?</p>
<p class="text-xl text-gray-600">üëâ Du dernier cri pour les curieux,</p>
        <p class="text-xl text-gray-600">
üëâ Des grands classiques pour les puristes,</p>
        <p class="text-xl text-gray-600">
üëâ Et surtout de quoi trouver l‚Äôengin qui vous fera d√©coller !
</p>
  </div>
</div>


      </div>

    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
  { sortedFleet.map(boat => (
    <FleetCard
      title={boat.data.title}
      type={boat.data.type}
      capacity={boat.data.capacity}
      description={boat.data.description}
      image={boat.data.image}
      slug={boat.slug} 
    />
  ))}
</div>
	        <div class="text-center mt-6 mb-1">
        <p class="text-xl text-gray-600">
  üëâ En solo, √† deux ou en tribu, larguez les amarres et partez explorer la baie de Lancieux √† votre fa√ßon !
</p>
    </div>
	</div>
  </section>


<!-- SECTION ACTIVIT√âS SP√âCIFIQUES -->
  <!--<section  id="prestations" class="py-20 bg-white border-t border-gray-100">
    <div class="max-w-7xl mx-auto px-4">
      <div class="text-center mb-16">
        <h2 class="text-4xl font-bold text-gray-900 font-heading">Envie de plus ?</h2>
        <p class="mt-4 text-xl text-gray-600">D√©couvrez nos formules sur mesure pour progresser ou faire la f√™te.</p>
      </div>

      <div class="grid md:grid-cols-2 gap-8 lg:gap-12">
        
        <a href="/cours-particuliers" class="group relative rounded-2xl overflow-hidden h-80 shadow-lg hover:shadow-2xl transition-all duration-300">
          <div class="absolute inset-0">
            <img src="/images/coursparticulier.jpg" alt="Cours de voile" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700" />
            <div class="absolute inset-0 bg-gradient-to-t from-gray-900/90 via-gray-900/40 to-transparent"></div>
          </div>
          <div class="absolute bottom-0 left-0 p-8 w-full">
            <h3 class="text-3xl font-bold text-white mb-2 font-heading">Cours Particuliers</h3>
            <p class="text-gray-200 mb-4 line-clamp-2">Coaching personnalis√© avec moniteur dipl√¥m√© pour progresser rapidement.</p>
            <span class="inline-flex items-center text-emerald-300 font-bold group-hover:text-white transition">
              En savoir plus <span class="ml-2 transform group-hover:translate-x-1 transition">‚Üí</span>
            </span>
          </div>
        </a>

        <a href="/groupes" class="group relative rounded-2xl overflow-hidden h-80 shadow-lg hover:shadow-2xl transition-all duration-300">
          <div class="absolute inset-0">
            <img src="/images/ejf.webp" alt="Groupe EVJF" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700" />
            <div class="absolute inset-0 bg-gradient-to-t from-gray-900/90 via-gray-900/40 to-transparent"></div>
          </div>
          <div class="absolute bottom-0 left-0 p-8 w-full">
            <div class="flex justify-between items-end">
              <div>
                <h3 class="text-3xl font-bold text-white mb-2 font-heading">Groupes & EVJF</h3>
                <p class="text-gray-200 mb-4 line-clamp-2">Anniversaires, s√©minaires ou enterrement de vie de c√©libataire.</p>
              </div>
              <span class="mb-8 text-3xl animate-bounce">üéâ</span>
            </div>
            <span class="inline-flex items-center text-yellow-300 font-bold group-hover:text-white transition">
              Voir les offres <span class="ml-2 transform group-hover:translate-x-1 transition">‚Üí</span>
            </span>
          </div>
        </a>

      </div>
    </div>
  </section>
-->
  <!-- SECTION 3: ACTIVIT√âS SP√âCIFIQUES (DYNAMIQUE) -->
    {featuredPages.length > 0 && (
      <section id="prestations" class="py-20 bg-white border-t border-gray-100">
        <div class="max-w-7xl mx-auto px-4">
          <div class="text-center mb-16">
            <h2 class="text-4xl font-bold text-gray-900 font-heading">Envie de plus ?</h2>
            <p class="mt-4 text-xl text-gray-600">D√©couvrez nos formules sur mesure.</p>
          </div>

          <div class="grid md:grid-cols-2 gap-8 lg:gap-12">
            
            {featuredPages.map(page => (
              <a href={`/pages/${page.slug}`} class="group relative rounded-2xl overflow-hidden h-80 shadow-lg hover:shadow-2xl transition-all duration-300 block">
                <!-- Image de fond -->
                <div class="absolute inset-0 bg-gray-900">
                  {page.data.image ? (
                    <img 
                      src={page.data.image} 
                      alt={page.data.title} 
                      class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700 opacity-80 group-hover:opacity-60"
                      transition:name={`hero-${page.slug}`}
                    />
                  ) : (
                    <div class="w-full h-full bg-emerald-800 opacity-50"></div>
                  )}
                  <!-- D√©grad√© pour lisibilit√© texte -->
                  <div class="absolute inset-0 bg-gradient-to-t from-gray-900 via-gray-900/20 to-transparent"></div>
                </div>

                <!-- Contenu Carte -->
                <div class="absolute bottom-0 left-0 p-8 w-full z-10">
            <div class="flex justify-between items-end">
              <div>
                <h3 class="text-3xl font-bold text-white mb-2 font-heading">
                    {page.data.title}
                </h3>
                <p class="text-gray-200 mb-4 line-clamp-2">
                    {page.data.subtitle}
                </p>
              </div>
              <span v-if="page.data.iconfirstpage" class="mb-8 text-3xl animate-bounce">{page.data.iconfirstpage}</span>
            </div>
                  <span class="inline-flex items-center text-emerald-300 font-bold group-hover:text-white transition uppercase tracking-wider text-sm">
                    D√©couvrir les offres <span class="ml-2 transform group-hover:translate-x-1 transition">‚Üí</span>
                  </span>
          </div>


                
              </a>
            ))}

          </div>
        </div>
      </section>
    )}

  <!-- TARIFS SECTION -->
  <section id="pricing" class="py-20 bg-emerald-50">
    <div class="max-w-7xl mx-auto px-4">
      <div class="text-center mb-12">
        <h2 class="text-4xl font-bold text-gray-900">Tarifs & R√©servation</h2>
        <p class="mt-4 text-lg text-gray-600">Tout inclus : combinaison, gilet, harnais.</p>
      </div>
      <div class="max-w-4xl mx-auto">

	   <Pricing 
        client:visible 
        items={pricingData.pricing_table}
		happyHourTitle={pricingData.happyHourTitle}
        happyHourHtml={happyHourHtml}  
        happyHourSubtext={pricingData.happyHourSubtext} 
      />

      </div>
    </div>
  </section>

    <Contact /> 

  <!-- INFO PRATIQUES / CONTACT -->
<!--  <section id="contact" class="py-20 bg-white">
    <div class="max-w-7xl mx-auto px-4 grid md:grid-cols-2 gap-12">
      <div>
        <h2 class="text-3xl font-bold mb-6">Comment louer ?</h2>
        <ol class="space-y-4 text-lg text-gray-700">
          <li class="flex items-start">
            <span class="bg-emerald-600 text-white rounded-full w-8 h-8 flex items-center justify-center mr-4 flex-shrink-0">1</span>
            Appelez-nous pour r√©server
          </li>
          <li class="flex items-start">
            <span class="bg-emerald-600 text-white rounded-full w-8 h-8 flex items-center justify-center mr-4 flex-shrink-0">2</span>
            Rendez-vous Plage de Saint-Sieu √† Lancieux
          </li>
          <li class="flex items-start">
            <span class="bg-emerald-600 text-white rounded-full w-8 h-8 flex items-center justify-center mr-4 flex-shrink-0">3</span>
            On s'occupe de la mise √† l'eau et du mat√©riel
          </li>
        </ol>
        
        <div class="mt-8 p-6 bg-gray-100 rounded-lg">
          <h3 class="font-bold mb-2">üìç Adresse</h3>
          <p>Plage de Saint-Sieu, Lancieux (35)</p>
          <p class="text-sm text-gray-500 mt-2">Bateau de s√©curit√© motoris√© toujours √† proximit√©.</p>
        </div>
      </div>
      
      <div class="flex flex-col justify-center items-center bg-emerald-900 text-white p-8 rounded-2xl text-center">
        <h3 class="text-2xl font-bold mb-4">R√©servez votre session</h3>
        <p class="mb-8">Que vous veniez de Saint-Briac, Saint-Lunaire ou d'ailleurs.</p>
        <a href="tel:+33600000000" class="text-3xl font-bold bg-white text-emerald-900 px-8 py-4 rounded-full hover:bg-emerald-100 transition shadow-lg">
          üìû 06 XX XX XX XX
        </a>
        <p class="mt-4 text-sm opacity-75">Ouvert tous les jours en saison</p>
      </div>
    </div>
  </section> -->
</Layout>