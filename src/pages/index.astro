---
import "../styles/global.css";
import Layout from '../layouts/Layout.astro';
import Pricing from '../components/Pricing.vue';
import Header from '../components/Header.vue';
import FleetCard from '../components/FleetCard.astro';
import { getCollection } from 'astro:content';
import  Contact from '../components/Contact.astro';
import Hero from '../components/Hero.vue';
import NewsCard from '../components/NewsCard.astro';
import WeatherWidget from '../components/WeatherWidget.vue'; 

import { getEntry } from 'astro:content';

// 1. RÃ©cupÃ©rer les donnÃ©es du fichier hero.md
const heroEntry = await getEntry('sections', 'hero')!;
const { Content: HeroContent } = await heroEntry.render();
import { marked } from 'marked'; // <--- Import de la librairie

// RÃ©cupÃ©ration des actualitÃ©s
const allNews = await getCollection('news');
// Tri par date dÃ©croissante et rÃ©cupÃ©ration des 3 premiÃ¨res
const latestNews = allNews
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf())
  .slice(0, 3);

// RÃ©cupÃ©ration des donnÃ©es Tarifs
const pricingEntry = await getEntry('pricing', 'pricing')!;
const pricingData = pricingEntry.data;
const happyHourHtml = pricingData.happyHourText 
  ? marked.parse(pricingData.happyHourText) 
  : '';

//  console.error(happyHourHtml)
// RÃ©cupÃ©ration des donnÃ©es MDX
const fleet = await getCollection('fleet');
// Tri des bateaux : Catamarans d'abord, puis Kayaks/Paddle
const sortedFleet = fleet.sort((a, b) => a.data.type.localeCompare(b.data.type));

---

<Layout title="Ã‰meraude Loca-fun | Location Catamaran & Kayak Ã  Lancieux">
  <Header client:load />

<Hero 
    client:load
    title={heroEntry.data.title}
    subtitle={heroEntry.data.subtitle}
    saison={heroEntry.data.saison}
    image={heroEntry.data.image!}
  >
    <!-- On injecte le corps du texte (le body du markdown) dans le slot du composant -->
    <HeroContent />
	</Hero>


<!-- NOUVELLE SECTION : ACTUALITÃ‰S -->
 <section class="py-12 bg-gray-50 relative z-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      
      <!-- Layout : Colonne Actus (gauche) / Colonne MÃ©tÃ©o (droite) -->
      <div class="grid lg:grid-cols-3 gap-8 items-start">
        
        <!-- COLONNE GAUCHE : LES ACTUALITÃ‰S (Prend 2 colonnes sur grand Ã©cran) -->
        <div class="lg:col-span-2">
           <div class="flex justify-between items-end mb-6">
              <h2 class="text-2xl font-bold text-gray-900 font-heading">DerniÃ¨res ActualitÃ©s</h2>
              <a href="/actualites" class="text-emerald-600 font-bold hover:text-emerald-800 text-sm">Toutes les actus â†’</a>
           </div>

           {latestNews.length > 0 ? (
             <div class="grid sm:grid-cols-2 gap-6">
                {/* On affiche seulement les 2 derniÃ¨res actus pour l'Ã©quilibre visuel, ou 3 si vous prÃ©fÃ©rez */}
                {latestNews.slice(0, 2).map(news => (
                  <NewsCard 
                    title={news.data.title}
                    publishDate={news.data.publishDate}
                    excerpt={news.data.excerpt}
                    image={news.data.image}
                    slug={news.slug}
                  />
                ))}
             </div>
           ) : (
             <p class="text-gray-500 italic">La saison reprend bientÃ´t !</p>
           )}
        </div>

        <!-- COLONNE DROITE : WIDGET MÃ‰TÃ‰O (Sticky pour rester visible) -->
        <div class="lg:col-span-1 lg:sticky lg:top-24 mt-8 lg:mt-0">
          <h3 class="text-lg font-bold text-gray-900 mb-4 font-heading pl-1">Conditions en direct</h3>
          <!-- Le Widget Vue -->
          <WeatherWidget client:visible />
          
          <p class="text-xs text-gray-400 mt-2 text-center">
            DonnÃ©es GFS 13km via Open-Meteo. <br>Mise Ã  jour toutes les heures.
          </p>
        </div>

      </div>

    </div>
  </section>

  <!-- FLOTTE SECTION -->
  <section id="fleet" class="py-20 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 text-center">
      <div class=" mb-8">
        <h2 class="text-4xl font-bold text-gray-900 mb-4">Notre Flotte</h2>
<div class="flex justify-center"> <!-- Centre le bloc enfant -->
  <div class="w-fit text-left">   <!-- Le bloc s'adapte au contenu -->
        <p class="text-xl text-gray-600">CÃ´tÃ© matos ?</p>
<p class="text-xl text-gray-600">ğŸ‘‰ Du dernier cri pour les curieux,</p>
        <p class="text-xl text-gray-600">
ğŸ‘‰ Des grands classiques pour les puristes,</p>
        <p class="text-xl text-gray-600">
ğŸ‘‰ Et surtout de quoi trouver lâ€™engin qui vous fera dÃ©coller !
</p>
  </div>
</div>


      </div>

    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
  { sortedFleet.map(boat => (
    <FleetCard
      title={boat.data.title}
      type={boat.data.type}
      capacity={boat.data.capacity}
      description={boat.data.description}
      image={boat.data.image}
      slug={boat.slug} 
    />
  ))}
</div>
	        <div class="text-center mt-6 mb-1">
        <p class="text-xl text-gray-600">
  ğŸ‘‰ En solo, Ã  deux ou en tribu, larguez les amarres et partez explorer la baie de Lancieux Ã  votre faÃ§on !
</p>
    </div>
	</div>
  </section>


<!-- SECTION ACTIVITÃ‰S SPÃ‰CIFIQUES -->
  <section  id="prestations" class="py-20 bg-white border-t border-gray-100">
    <div class="max-w-7xl mx-auto px-4">
      <div class="text-center mb-16">
        <h2 class="text-4xl font-bold text-gray-900 font-heading">Envie de plus ?</h2>
        <p class="mt-4 text-xl text-gray-600">DÃ©couvrez nos formules sur mesure pour progresser ou faire la fÃªte.</p>
      </div>

      <div class="grid md:grid-cols-2 gap-8 lg:gap-12">
        
        <!-- Carte Cours Particuliers -->
        <a href="/cours-particuliers" class="group relative rounded-2xl overflow-hidden h-80 shadow-lg hover:shadow-2xl transition-all duration-300">
          <div class="absolute inset-0">
            <img src="/images/coursparticulier.jpg" alt="Cours de voile" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700" />
            <div class="absolute inset-0 bg-gradient-to-t from-gray-900/90 via-gray-900/40 to-transparent"></div>
          </div>
          <div class="absolute bottom-0 left-0 p-8 w-full">
            <h3 class="text-3xl font-bold text-white mb-2 font-heading">Cours Particuliers</h3>
            <p class="text-gray-200 mb-4 line-clamp-2">Coaching personnalisÃ© avec moniteur diplÃ´mÃ© pour progresser rapidement.</p>
            <span class="inline-flex items-center text-emerald-300 font-bold group-hover:text-white transition">
              En savoir plus <span class="ml-2 transform group-hover:translate-x-1 transition">â†’</span>
            </span>
          </div>
        </a>

        <!-- Carte Groupes -->
        <a href="/groupes" class="group relative rounded-2xl overflow-hidden h-80 shadow-lg hover:shadow-2xl transition-all duration-300">
          <div class="absolute inset-0">
            <img src="/images/ejf.webp" alt="Groupe EVJF" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700" />
            <div class="absolute inset-0 bg-gradient-to-t from-gray-900/90 via-gray-900/40 to-transparent"></div>
          </div>
          <div class="absolute bottom-0 left-0 p-8 w-full">
            <div class="flex justify-between items-end">
              <div>
                <h3 class="text-3xl font-bold text-white mb-2 font-heading">Groupes & EVJF</h3>
                <p class="text-gray-200 mb-4 line-clamp-2">Anniversaires, sÃ©minaires ou enterrement de vie de cÃ©libataire.</p>
              </div>
              <!-- Petit badge fun -->
              <span class="mb-8 text-3xl animate-bounce">ğŸ‰</span>
            </div>
            <span class="inline-flex items-center text-yellow-300 font-bold group-hover:text-white transition">
              Voir les offres <span class="ml-2 transform group-hover:translate-x-1 transition">â†’</span>
            </span>
          </div>
        </a>

      </div>
    </div>
  </section>

  <!-- TARIFS SECTION -->
  <section id="pricing" class="py-20 bg-emerald-50">
    <div class="max-w-7xl mx-auto px-4">
      <div class="text-center mb-12">
        <h2 class="text-4xl font-bold text-gray-900">Tarifs & RÃ©servation</h2>
        <p class="mt-4 text-lg text-gray-600">Tout inclus : combinaison, gilet, harnais.</p>
      </div>
      <div class="max-w-4xl mx-auto">

	   <Pricing 
        client:visible 
        items={pricingData.pricing_table}
		happyHourTitle={pricingData.happyHourTitle}
        happyHourHtml={happyHourHtml}  
        happyHourSubtext={pricingData.happyHourSubtext} 
      />

      </div>
    </div>
  </section>

    <Contact /> 

  <!-- INFO PRATIQUES / CONTACT -->
<!--  <section id="contact" class="py-20 bg-white">
    <div class="max-w-7xl mx-auto px-4 grid md:grid-cols-2 gap-12">
      <div>
        <h2 class="text-3xl font-bold mb-6">Comment louer ?</h2>
        <ol class="space-y-4 text-lg text-gray-700">
          <li class="flex items-start">
            <span class="bg-emerald-600 text-white rounded-full w-8 h-8 flex items-center justify-center mr-4 flex-shrink-0">1</span>
            Appelez-nous pour rÃ©server
          </li>
          <li class="flex items-start">
            <span class="bg-emerald-600 text-white rounded-full w-8 h-8 flex items-center justify-center mr-4 flex-shrink-0">2</span>
            Rendez-vous Plage de Saint-Sieu Ã  Lancieux
          </li>
          <li class="flex items-start">
            <span class="bg-emerald-600 text-white rounded-full w-8 h-8 flex items-center justify-center mr-4 flex-shrink-0">3</span>
            On s'occupe de la mise Ã  l'eau et du matÃ©riel
          </li>
        </ol>
        
        <div class="mt-8 p-6 bg-gray-100 rounded-lg">
          <h3 class="font-bold mb-2">ğŸ“ Adresse</h3>
          <p>Plage de Saint-Sieu, Lancieux (35)</p>
          <p class="text-sm text-gray-500 mt-2">Bateau de sÃ©curitÃ© motorisÃ© toujours Ã  proximitÃ©.</p>
        </div>
      </div>
      
      <div class="flex flex-col justify-center items-center bg-emerald-900 text-white p-8 rounded-2xl text-center">
        <h3 class="text-2xl font-bold mb-4">RÃ©servez votre session</h3>
        <p class="mb-8">Que vous veniez de Saint-Briac, Saint-Lunaire ou d'ailleurs.</p>
        <a href="tel:+33600000000" class="text-3xl font-bold bg-white text-emerald-900 px-8 py-4 rounded-full hover:bg-emerald-100 transition shadow-lg">
          ğŸ“ 06 XX XX XX XX
        </a>
        <p class="mt-4 text-sm opacity-75">Ouvert tous les jours en saison</p>
      </div>
    </div>
  </section> -->
</Layout>