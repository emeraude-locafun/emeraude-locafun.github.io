---
import "../../styles/global.css";

import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.vue';
import ResponsiveImage from '../../components/ResponsiveImage.vue';

// 1. G√©n√©ration des routes statiques pour chaque fichier MDX trouv√© dans src/content/fleet/
export async function getStaticPaths() {
  const fleetEntries = await getCollection('fleet');
  return fleetEntries.map(entry => ({
    params: { slug: entry.slug }, props: { entry },
  }));
}

// 2. R√©cup√©ration des donn√©es de la page courante
const { entry } = Astro.props;
const { Content } = await entry.render();

// Petit helper pour la couleur du badge selon le type
const typeColor = entry.data.type === 'Catamaran' ? 'bg-blue-100 text-blue-800' 
                : entry.data.type === 'Kayak' ? 'bg-orange-100 text-orange-800'
                : 'bg-emerald-100 text-emerald-800';
---

<Layout title={`${entry.data.title} | √âmeraude Loca-fun`} description={entry.data.description}>
  <Header client:load />

  <main class="bg-white min-h-screen pb-20">
    
    <!-- Hero Image du bateau -->
    <div class="relative h-[50vh] min-h-[400px] w-full bg-gray-900">
      {entry.data.image && (
        <img 
          src={entry.data.image} 
          alt={entry.data.title} 
          class="w-full h-full object-cover opacity-80"
          transition:name={`image-${entry.slug}`} 
        />
      )}
      <div class="absolute inset-0 bg-gradient-to-t from-gray-900 via-transparent to-transparent"></div>
      
      <div class="absolute bottom-0 left-0 w-full p-8 md:p-12">
        <div class="max-w-4xl mx-auto">
          <span class={`inline-block px-3 py-1 rounded-full text-sm font-bold uppercase tracking-wide mb-4 ${typeColor}`}>
            {entry.data.type}
          </span>
          <h1 class="text-4xl md:text-6xl font-bold text-white mb-2 font-heading">
            {entry.data.title}
          </h1>
          <p class="text-xl text-gray-200 flex items-center">
            <span class="mr-2">üë•</span> {entry.data.capacity}
          </p>
        </div>
      </div>
    </div>

    <!-- Contenu MDX + Sidebar -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-12 grid grid-cols-1 lg:grid-cols-3 gap-12">
      
      <!-- Colonne Principale : Le contenu riche (MDX) -->
      <div class="lg:col-span-2">
        <div class="prose prose-lg prose-emerald max-w-none">
            <!-- C'est ici que le contenu r√©dig√© dans Decap CMS s'affiche -->
            <Content components={{ ResponsiveImage }} />
        </div>
        
        <div class="mt-12 pt-8 border-t border-gray-100">
          <a href="/#fleet" class="text-emerald-600 font-bold hover:underline flex items-center">
            ‚Üê Retour √† la flotte
          </a>
        </div>
      </div>

      <!-- Sidebar : R√©servation & Infos -->
      <div class="lg:col-span-1">
        <div class="bg-gray-50 p-6 rounded-xl border border-gray-200 sticky top-24">
          <h3 class="text-xl font-bold text-gray-900 mb-4">Envie de naviguer ?</h3>
          <p class="text-gray-600 mb-6 text-sm">
            Ce {entry.data.title} vous attend sur la plage de Saint-Sieu. Tout l'√©quipement est fourni.
          </p>
          
          <div class="space-y-3">
            <a href="/#contact" class="block w-full text-center bg-emerald-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-emerald-700 transition shadow-lg shadow-emerald-200">
              R√©server ce bateau
            </a>
            <a href="/#pricing" class="block w-full text-center bg-white border border-gray-300 text-gray-700 font-bold py-3 px-4 rounded-lg hover:bg-gray-50 transition">
              Voir les tarifs
            </a>
          </div>

          <div class="mt-8">
            <h4 class="font-bold text-sm text-gray-900 uppercase tracking-wider mb-3">Caract√©ristiques</h4>
            <ul class="text-sm space-y-2 text-gray-600">
              <li class="flex justify-between border-b border-gray-200 pb-2">
                <span>Capacit√©</span>
                <span class="font-medium text-gray-900">{entry.data.capacity}</span>
              </li>
              <li class="flex justify-between border-b border-gray-200 pb-2">
                <span>Type</span>
                <span class="font-medium text-gray-900">{entry.data.type}</span>
              </li>
              <!-- Vous pouvez ajouter d'autres champs dans le frontmatter plus tard -->
            </ul>
          </div>
        </div>
      </div>

    </div>
  </main>
</Layout>